<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <title>Class Feedback Form</title>
</head>
<body>
    <h1 id="title">Class Feedback Form</h1>
    
    <!-- Language Selection -->
    <div class="section">
        <label for="language">Select Language:</label>
        <select id="language" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="fr">Français</option>
        </select>
    </div>

    <!-- Class Selection -->
    <div class="section">
        <h2 id="class-selection-title">Select Classes</h2>
        <label><input type="checkbox" name="classes" value="Math101" onclick="toggleQuestions()"> Math 101</label><br>
        <label><input type="checkbox" name="classes" value="CS102" onclick="toggleQuestions()"> Computer Science 102</label><br>
        <label><input type="checkbox" name="classes" value="Hist103" onclick="toggleQuestions()"> History 103</label>
    </div>

    <!-- Questions Section -->
    <div class="section" id="questions-section">
        <!-- Dynamic questions will be inserted here -->
    </div>

    <!-- Alumni Information -->
    <div class="section">
        <label><input type="checkbox" id="share-info" onclick="toggleAlumniInfo()"> Share my info for an alumni process</label>
        <div id="alumni-info" class="hidden">
            <label>Full Name: <input type="text" id="full-name"></label><br>
            <label>Email: <input type="email" id="email"></label><br>
            <label>Speciality: <input type="text" id="speciality"></label><br>
            <label>LinkedIn: <input type="url" id="linkedin"></label>
        </div>
    </div>

     <!-- Generate Recap Button -->
     <div class="section">
        <button onclick="generateRecap()">Generate Recap</button>
    </div>

    <!-- Recap Section -->
    <div class="section hidden" id="recap-section">
        <h2>Recap</h2>
        <pre id="recap-text"></pre>
        <button onclick="copyRecapToClipboard()">Copy to Clipboard</button>
    </div>

    <script>
        const classNames = {
            'en': ['Math 101', 'Computer Science 102', 'History 103'],
            'fr': ['Mathématiques 101', 'Informatique 102', 'Histoire 103']
        };
    
        const labels = {
            'en': {
                'title': 'Class Feedback Form',
                'classSelectionTitle': 'Select Classes',
                'questionPrefix': 'What did you think about ',
                'shareInfo': 'Share my info for an alumni process',
                'fullName': 'Full Name',
                'email': 'Email',
                'speciality': 'Speciality',
                'linkedin': 'LinkedIn',
                'generateRecap': 'Generate Recap'
            },
            'fr': {
                'title': 'Formulaire de Feedback de Cours',
                'classSelectionTitle': 'Sélectionnez les Cours',
                'questionPrefix': 'Que pensez-vous de ',
                'shareInfo': 'Partager mes informations pour un processus d\'anciens élèves',
                'fullName': 'Nom Complet',
                'email': 'Email',
                'speciality': 'Spécialité',
                'linkedin': 'LinkedIn',
                'generateRecap': 'Générer le Récapitulatif'
            }
        };
    
        // Object to store textarea content
        const feedbackContent = {};
    
        function changeLanguage() {
            const lang = document.getElementById('language').value;
            document.cookie = `language=${lang}; path=/;`;
            updateLanguage(lang);
        }
    
        function updateLanguage(lang) {
            document.getElementById('title').innerText = labels[lang]['title'];
            document.getElementById('class-selection-title').innerText = labels[lang]['classSelectionTitle'];
            document.querySelector('label[for="language"]').innerText = labels[lang]['title'];
            document.querySelector('label[for="share-info"]').innerText = labels[lang]['shareInfo'];
            document.querySelector('label[for="full-name"]').innerText = labels[lang]['fullName'] + ':';
            document.querySelector('label[for="email"]').innerText = labels[lang]['email'] + ':';
            document.querySelector('label[for="speciality"]').innerText = labels[lang]['speciality'] + ':';
            document.querySelector('label[for="linkedin"]').innerText = labels[lang]['linkedin'] + ':';
            document.querySelector('button[onclick="generateRecap()"]').innerText = labels[lang]['generateRecap'];
    
            // Update class names
            const checkboxes = document.querySelectorAll('input[name="classes"]');
            checkboxes.forEach((checkbox, index) => {
                checkbox.nextSibling.nodeValue = ' ' + classNames[lang][index];
            });
        }
    
        function toggleQuestions() {
            const selectedClasses = document.querySelectorAll('input[name="classes"]:checked');
            const questionsSection = document.getElementById('questions-section');
            questionsSection.innerHTML = ''; // Clear previous questions
    
            selectedClasses.forEach((classCheckbox, index) => {
                const className = classCheckbox.nextSibling.nodeValue.trim();
                const questionLabel = document.createElement('label');
                questionLabel.innerText = `${labels[document.getElementById('language').value]['questionPrefix']}${className}:`;
    
                const textarea = document.createElement('textarea');
                textarea.className = 'rich-text';
                textarea.setAttribute('data-class-index', index); // Add a data attribute to link textarea to checkbox
    
                // Restore content if available
                const savedContent = feedbackContent[classCheckbox.value] || getCookieContent(classCheckbox.value);
                if (savedContent) {
                    textarea.value = savedContent;
                }
    
                // Add an event listener to save content on change
                textarea.addEventListener('input', () => {
                    feedbackContent[classCheckbox.value] = textarea.value;
                    saveFeedbackToCookies();
                });
    
                questionsSection.appendChild(questionLabel);
                questionsSection.appendChild(textarea);
            });
        }
    
        function toggleAlumniInfo() {
            const alumniInfoSection = document.getElementById('alumni-info');
            if (document.getElementById('share-info').checked) {
                alumniInfoSection.classList.remove('hidden');
            } else {
                alumniInfoSection.classList.add('hidden');
            }
        }
    
        function generateRecap() {
            const lang = document.getElementById('language').value;
            const selectedClasses = document.querySelectorAll('input[name="classes"]:checked');
            let recapText = `Dear Mrs Boyer,\n\nHere is a recap of what I thought about the different classes I had:\n\n`;
    
            selectedClasses.forEach((classCheckbox, index) => {
                const className = classCheckbox.nextSibling.nodeValue.trim();
                const textarea = document.querySelector(`textarea[data-class-index="${index}"]`);
                recapText += `I took class ${className} and thought:\n${textarea.value}\n\n`;
            });
    
            if (document.getElementById('share-info').checked) {
                const fullName = document.getElementById('full-name').value;
                const email = document.getElementById('email').value;
                const speciality = document.getElementById('speciality').value;
                const linkedin = document.getElementById('linkedin').value;
                recapText += `I heard you also want to make an alumni process, you can contact me on ${linkedin}, ${email}.\n\nThank you for everything this year,\n\nBest regards,\n${fullName}\n\n`;
            }
    
            recapText += `PS: this mail was auto-generated using <url>`;
            document.getElementById('recap-text').innerText = recapText;
            document.getElementById('recap-section').classList.remove('hidden');
        }
    
        function saveFeedbackToCookies() {
            // Save each feedback to cookies
            Object.keys(feedbackContent).forEach(classValue => {
                document.cookie = `${classValue}=${encodeURIComponent(feedbackContent[classValue])}; path=/;`;
            });
        }
    
        function getCookieContent(classValue) {
            const cookies = document.cookie.split('; ').reduce((acc, cookie) => {
                const [name, value] = cookie.split('=');
                acc[name] = decodeURIComponent(value);
                return acc;
            }, {});
    
            return cookies[classValue] || '';
        }

        function copyRecapToClipboard() {
            const recapText = document.getElementById('recap-text').innerText;
            navigator.clipboard.writeText(recapText).then(() => {
                alert('Recap copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy text: ' + err);
            });
        }
    
        // Set initial language from cookies or default to English
        const langCookie = document.cookie.split('; ').find(row => row.startsWith('language='));
        const lang = langCookie ? langCookie.split('=')[1] : 'en';
        document.getElementById('language').value = lang;
        updateLanguage(lang);
    
    </script>
    
</body>
</html>
